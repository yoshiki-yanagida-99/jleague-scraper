# -*- coding: utf-8 -*-
"""jãƒªãƒ¼ã‚°_ã‚¹ã‚¿ãƒƒãƒ„ãƒ©ãƒ³ã‚­ãƒ³ã‚°.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1D8VNG_Ku-tGqs_m8NZrvf5aI-MMt2Nk2
"""

import requests
from bs4 import BeautifulSoup
import pandas as pd
import re
import time

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1) è¾æ›¸é¡
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
season_dict = {
    "2025": "2025å¹´ã‚·ãƒ¼ã‚ºãƒ³",
    "2024": "2024å¹´ã‚·ãƒ¼ã‚ºãƒ³"
}

stat_type_dict = {
    "game": "å‡ºå ´è©¦åˆæ•°",
    "time": "å‡ºå ´æ™‚é–“",
    "shoot": "ã‚·ãƒ¥ãƒ¼ãƒˆç·æ•°",
    "shoot_per_game": "1è©¦åˆå¹³å‡ã‚·ãƒ¥ãƒ¼ãƒˆæ•°",
    "shoot_on_target": "æ å†…ã‚·ãƒ¥ãƒ¼ãƒˆç·æ•°",
    "shoot_rate": "ã‚·ãƒ¥ãƒ¼ãƒˆæ±ºå®šç‡",
    "suffer_shoot": "è¢«ã‚·ãƒ¥ãƒ¼ãƒˆç·æ•°",
    "suffer_shoot_on_target": "è¢«æ å†…ã‚·ãƒ¥ãƒ¼ãƒˆç·æ•°",
    "score": "å¾—ç‚¹ãƒ©ãƒ³ã‚­ãƒ³ã‚°",
    "fk_score": "FKå¾—ç‚¹æ•°",
    "pk_score": "PKå¾—ç‚¹æ•°",
    "left_foot_score": "å·¦è¶³å¾—ç‚¹æ•°",
    "right_foot_score": "å³è¶³å¾—ç‚¹æ•°",
    "head_score": "ãƒ˜ãƒ‡ã‚£ãƒ³ã‚°å¾—ç‚¹æ•°",
    "other_type_score": "ãã®ä»–éƒ¨ä½å¾—ç‚¹æ•°",
    "expected_goals": "ã‚´ãƒ¼ãƒ«æœŸå¾…å€¤",
    "expected_goals_excl_pk": "ã‚´ãƒ¼ãƒ«æœŸå¾…å€¤ï¼ˆPKé™¤ãï¼‰",
    "expected_goals_diff": "å¾—ç‚¹æ•°ã¨ã‚´ãƒ¼ãƒ«æœŸå¾…å€¤ã®å·®åˆ†",
    "assist": "ã‚¢ã‚·ã‚¹ãƒˆç·æ•°",
    "lost": "å¤±ç‚¹ç·æ•°",
    "play_count": "ãƒ—ãƒ¬ãƒ¼ç·æ•°",
    "play_count_per_game": "1è©¦åˆå¹³å‡ãƒ—ãƒ¬ãƒ¼æ•°",
    "pass_count": "ãƒ‘ã‚¹ç·æ•°",
    "pass_count_per_game": "1è©¦åˆå¹³å‡ãƒ‘ã‚¹æ•°",
    "pass_rate": "ãƒ‘ã‚¹æˆåŠŸç‡",
    "opponent_area_pass_count": "æ•µé™£ãƒ‘ã‚¹æ•°",
    "opponent_area_pass_rate": "æ•µé™£ãƒ‘ã‚¹æˆåŠŸç‡",
    "opponent_area_pass_count_per_game": "1è©¦åˆå¹³å‡æ•µé™£ãƒ‘ã‚¹æ•°",
    "own_area_pass_count": "è‡ªé™£ãƒ‘ã‚¹æ•°",
    "own_area_pass_rate": "è‡ªé™£ãƒ‘ã‚¹æˆåŠŸç‡",
    "own_area_pass_count_per_game": "1è©¦åˆå¹³å‡è‡ªé™£ãƒ‘ã‚¹æ•°",
    "long_pass_count": "ãƒ­ãƒ³ã‚°ãƒ‘ã‚¹ç·æ•°",
    "long_pass_rate": "ãƒ­ãƒ³ã‚°ãƒ‘ã‚¹æˆåŠŸç‡",
    "long_pass_count_per_game": "1è©¦åˆå¹³å‡ãƒ­ãƒ³ã‚°ãƒ‘ã‚¹æ•°",
    "dribble_count": "ãƒ‰ãƒªãƒ–ãƒ«ç·æ•°",
    "dribble_rate": "ãƒ‰ãƒªãƒ–ãƒ«æˆåŠŸç‡",
    "through_pass_count": "ã‚¹ãƒ«ãƒ¼ãƒ‘ã‚¹ç·æ•°",
    "through_pass_rate": "ã‚¹ãƒ«ãƒ¼ãƒ‘ã‚¹æˆåŠŸç‡",
    "cross_count": "ã‚¯ãƒ­ã‚¹ç·æ•°",
    "cross_rate": "ã‚¯ãƒ­ã‚¹æˆåŠŸç‡",
    "cross_count_per_game": "1è©¦åˆå¹³å‡ã‚¯ãƒ­ã‚¹æ•°",
    "clear_count": "ã‚¯ãƒªã‚¢ç·æ•°",
    "tackle_count": "ã‚¿ãƒƒã‚¯ãƒ«ç·æ•°",
    "tackle_rate": "ã‚¿ãƒƒã‚¯ãƒ«æˆåŠŸç‡",
    "tackle_count_per_game": "1è©¦åˆå¹³å‡ã‚¿ãƒƒã‚¯ãƒ«æ•°",
    "block_count": "ãƒ–ãƒ­ãƒƒã‚¯ç·æ•°",
    "intercept_count": "ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆç·æ•°",
    "intercept_count_per_game": "1è©¦åˆå¹³å‡ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆæ•°",
    "air_battle_win_count": "ç©ºä¸­æˆ¦å‹åˆ©æ•°",
    "air_battle_win_rate": "ç©ºä¸­æˆ¦å‹ç‡",
    "foul_count": "ãƒ•ã‚¡ã‚¦ãƒ«ç·æ•°",
    "suffer_foul_count": "è¢«ãƒ•ã‚¡ã‚¦ãƒ«ç·æ•°",
    "yellow_count": "è­¦å‘Šæ•°",
    "red_count": "é€€å ´æ•°",
    "chance_create": "ãƒãƒ£ãƒ³ã‚¹ã‚¯ãƒªã‚¨ã‚¤ãƒˆç·æ•°",
    "chance_create_per_game": "1è©¦åˆå¹³å‡ãƒãƒ£ãƒ³ã‚¹ã‚¯ãƒªã‚¨ã‚¤ãƒˆæ•°",
    "duels_won": "ãƒ‡ãƒ¥ã‚¨ãƒ«å‹åˆ©ç·æ•°",
    "recovery_count": "ã“ã¼ã‚Œçƒå¥ªå–ç·æ•°",
    "fk": "FKç·æ•°",
    "ck": "CKç·æ•°",
    "save_count": "ã‚»ãƒ¼ãƒ–ç·æ•°",
    "save_rate": "ã‚»ãƒ¼ãƒ–ç‡",
    "save_count_per_game": "1è©¦åˆå¹³å‡ã‚»ãƒ¼ãƒ–æ•°",
    "save_rate_in_pa": "PAå†…ã‚·ãƒ¥ãƒ¼ãƒˆã‚»ãƒ¼ãƒ–ç‡",
    "save_rate_out_pa": "PAå¤–ã‚·ãƒ¥ãƒ¼ãƒˆã‚»ãƒ¼ãƒ–ç‡",
    "save_catch_rate_in_pa": "PAå†…ã‚·ãƒ¥ãƒ¼ãƒˆã‚­ãƒ£ãƒƒãƒç‡",
    "save_catch_rate_out_pa": "PAå¤–ã‚·ãƒ¥ãƒ¼ãƒˆã‚­ãƒ£ãƒƒãƒç‡",
    "cross_catch_rate": "ã‚¯ãƒ­ã‚¹ã‚­ãƒ£ãƒƒãƒç‡",
    "save_punch_rate_in_pa": "PAå†…ã‚·ãƒ¥ãƒ¼ãƒˆãƒ‘ãƒ³ãƒãƒ³ã‚°ç‡",
    "save_punch_rate_out_pa": "PAå¤–ã‚·ãƒ¥ãƒ¼ãƒˆãƒ‘ãƒ³ãƒãƒ³ã‚°ç‡",
    "cross_punch_rate": "ã‚¯ãƒ­ã‚¹ãƒ‘ãƒ³ãƒãƒ³ã‚°ç‡",
    "clean_sheet": "ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ¼ãƒˆç·æ•°",
    "distance": "ç·èµ°è¡Œè·é›¢",
    "top_speed": "ãƒˆãƒƒãƒ—ã‚¹ãƒ”ãƒ¼ãƒ‰",
    "sprint": "ç·ã‚¹ãƒ—ãƒªãƒ³ãƒˆå›æ•°",
    "at_sprint": "Atã‚¹ãƒ—ãƒªãƒ³ãƒˆå›æ•°",
    "mt_sprint": "Mtã‚¹ãƒ—ãƒªãƒ³ãƒˆå›æ•°",
    "dt_sprint": "Dtã‚¹ãƒ—ãƒªãƒ³ãƒˆå›æ•°",
    "possession_distance": "ãƒã‚¼ãƒƒã‚·ãƒ§ãƒ³æ™‚ã®èµ°è¡Œè·é›¢",
    "possession_sprint": "ãƒã‚¼ãƒƒã‚·ãƒ§ãƒ³æ™‚ã®ã‚¹ãƒ—ãƒªãƒ³ãƒˆå›æ•°"
}

club_dict_by_season_category = {
    "2024": {
        "j1": {
            "sapporo": "åŒ—æµ·é“ã‚³ãƒ³ã‚µãƒ‰ãƒ¼ãƒ¬æœ­å¹Œ", "kashima": "é¹¿å³¶ã‚¢ãƒ³ãƒˆãƒ©ãƒ¼ã‚º", "urawa": "æµ¦å’Œãƒ¬ãƒƒã‚º", "kashiwa": "æŸãƒ¬ã‚¤ã‚½ãƒ«",
            "ftokyo": "FCæ±äº¬", "tokyov": "æ±äº¬ãƒ´ã‚§ãƒ«ãƒ‡ã‚£", "machida": "FCç”ºç”°ã‚¼ãƒ«ãƒ“ã‚¢", "kawasakif": "å·å´ãƒ•ãƒ­ãƒ³ã‚¿ãƒ¼ãƒ¬",
            "yokohamafm": "æ¨ªæµœFãƒ»ãƒãƒªãƒã‚¹", "shonan": "æ¹˜å—ãƒ™ãƒ«ãƒãƒ¼ãƒ¬", "niigata": "ã‚¢ãƒ«ãƒ“ãƒ¬ãƒƒã‚¯ã‚¹æ–°æ½Ÿ", "iwata": "ã‚¸ãƒ¥ãƒ“ãƒ­ç£ç”°",
            "nagoya": "åå¤å±‹ã‚°ãƒ©ãƒ³ãƒ‘ã‚¹", "kyoto": "äº¬éƒ½ã‚µãƒ³ã‚¬F.C.", "gosaka": "ã‚¬ãƒ³ãƒå¤§é˜ª", "cosaka": "ã‚»ãƒ¬ãƒƒã‚½å¤§é˜ª",
            "kobe": "ãƒ´ã‚£ãƒƒã‚»ãƒ«ç¥æˆ¸", "hiroshima": "ã‚µãƒ³ãƒ•ãƒ¬ãƒƒãƒã‚§åºƒå³¶", "fukuoka": "ã‚¢ãƒ“ã‚¹ãƒ‘ç¦å²¡", "tosu": "ã‚µã‚¬ãƒ³é³¥æ –"
        },
        "j2": {
            "sendai": "ãƒ™ã‚¬ãƒ«ã‚¿ä»™å°", "akita": "ãƒ–ãƒ©ã‚¦ãƒ–ãƒªãƒƒãƒ„ç§‹ç”°", "yamagata": "ãƒ¢ãƒ³ãƒ†ãƒ‡ã‚£ã‚ªå±±å½¢", "iwaki": "ã„ã‚ãFC",
            "mito": "æ°´æˆ¸ãƒ›ãƒ¼ãƒªãƒ¼ãƒ›ãƒƒã‚¯", "tochigi": "æ ƒæœ¨SC", "gunma": "ã‚¶ã‚¹ãƒ‘ç¾¤é¦¬", "chiba": "ã‚¸ã‚§ãƒ•ãƒ¦ãƒŠã‚¤ãƒ†ãƒƒãƒ‰åƒè‘‰",
            "yokohamafc": "æ¨ªæµœFC", "kofu": "ãƒ´ã‚¡ãƒ³ãƒ•ã‚©ãƒ¼ãƒ¬ç”²åºœ", "shimizu": "æ¸…æ°´ã‚¨ã‚¹ãƒ‘ãƒ«ã‚¹", "fujieda": "è—¤æMYFC",
            "okayama": "ãƒ•ã‚¡ã‚¸ã‚¢ãƒ¼ãƒå²¡å±±", "yamaguchi": "ãƒ¬ãƒãƒ•ã‚¡å±±å£FC", "tokushima": "å¾³å³¶ãƒ´ã‚©ãƒ«ãƒ†ã‚£ã‚¹", "ehime": "æ„›åª›FC",
            "nagasaki": "Vãƒ»ãƒ•ã‚¡ãƒ¼ãƒ¬ãƒ³é•·å´", "kumamoto": "ãƒ­ã‚¢ãƒƒã‚½ç†Šæœ¬", "oita": "å¤§åˆ†ãƒˆãƒªãƒ‹ãƒ¼ã‚¿", "kagoshima": "é¹¿å…å³¶ãƒ¦ãƒŠã‚¤ãƒ†ãƒƒãƒ‰FC"
        },
        "j3": {
            "hachinohe": "ãƒ´ã‚¡ãƒ³ãƒ©ãƒ¼ãƒ¬å…«æˆ¸", "morioka": "ã„ã‚ã¦ã‚°ãƒ«ãƒ¼ã‚¸ãƒ£ç››å²¡", "fukushima": "ç¦å³¶ãƒ¦ãƒŠã‚¤ãƒ†ãƒƒãƒ‰FC", "omiya": "å¤§å®®ã‚¢ãƒ«ãƒ‡ã‚£ãƒ¼ã‚¸ãƒ£",
            "yscc": "Y.S.C.C.æ¨ªæµœ", "sagamihara": "SCç›¸æ¨¡åŸ", "matsumoto": "æ¾æœ¬å±±é›…FC", "nagano": "ACé•·é‡ãƒ‘ãƒ«ã‚»ã‚¤ãƒ­",
            "toyama": "ã‚«ã‚¿ãƒ¼ãƒ¬å¯Œå±±", "kanazawa": "ãƒ„ã‚¨ãƒ¼ã‚²ãƒ³é‡‘æ²¢", "numazu": "ã‚¢ã‚¹ãƒ«ã‚¯ãƒ©ãƒ­æ²¼æ´¥", "gifu": "FCå²é˜œ",
            "fcosaka": "FCå¤§é˜ª", "nara": "å¥ˆè‰¯ã‚¯ãƒ©ãƒ–", "tottori": "ã‚¬ã‚¤ãƒŠãƒ¼ãƒ¬é³¥å–", "sanuki": "ã‚«ãƒã‚¿ãƒãƒ¼ãƒ¬è®ƒå²",
            "imabari": "FCä»Šæ²»", "kitakyushu": "ã‚®ãƒ©ãƒ´ã‚¡ãƒ³ãƒ„åŒ—ä¹å·", "miyazaki": "ãƒ†ã‚²ãƒã‚¸ãƒ£ãƒ¼ãƒ­å®®å´", "ryukyu": "FCç‰çƒ"
        }
    },
    "2025": {
        "j1": {
            "kashima": "é¹¿å³¶ã‚¢ãƒ³ãƒˆãƒ©ãƒ¼ã‚º", "kashiwa": "æŸãƒ¬ã‚¤ã‚½ãƒ«", "tokyov": "æ±äº¬ãƒ´ã‚§ãƒ«ãƒ‡ã‚£", "kawasakif": "å·å´ãƒ•ãƒ­ãƒ³ã‚¿ãƒ¼ãƒ¬",
            "yokohamafc": "æ¨ªæµœFC", "niigata": "ã‚¢ãƒ«ãƒ“ãƒ¬ãƒƒã‚¯ã‚¹æ–°æ½Ÿ", "nagoya": "åå¤å±‹ã‚°ãƒ©ãƒ³ãƒ‘ã‚¹", "gosaka": "ã‚¬ãƒ³ãƒå¤§é˜ª",
            "kobe": "ãƒ´ã‚£ãƒƒã‚»ãƒ«ç¥æˆ¸", "hiroshima": "ã‚µãƒ³ãƒ•ãƒ¬ãƒƒãƒã‚§åºƒå³¶", "urawa": "æµ¦å’Œãƒ¬ãƒƒã‚º", "ftokyo": "FCæ±äº¬",
            "machida": "FCç”ºç”°ã‚¼ãƒ«ãƒ“ã‚¢", "yokohamafm": "æ¨ªæµœFãƒ»ãƒãƒªãƒã‚¹", "shonan": "æ¹˜å—ãƒ™ãƒ«ãƒãƒ¼ãƒ¬", "shimizu": "æ¸…æ°´ã‚¨ã‚¹ãƒ‘ãƒ«ã‚¹",
            "kyoto": "äº¬éƒ½ã‚µãƒ³ã‚¬F.C.", "cosaka": "ã‚»ãƒ¬ãƒƒã‚½å¤§é˜ª", "okayama": "ãƒ•ã‚¡ã‚¸ã‚¢ãƒ¼ãƒå²¡å±±", "fukuoka": "ã‚¢ãƒ“ã‚¹ãƒ‘ç¦å²¡"
        },
        "j2": {
            "sapporo": "åŒ—æµ·é“ã‚³ãƒ³ã‚µãƒ‰ãƒ¼ãƒ¬æœ­å¹Œ", "akita": "ãƒ–ãƒ©ã‚¦ãƒ–ãƒªãƒƒãƒ„ç§‹ç”°", "iwaki": "ã„ã‚ãFC", "omiya": "RBå¤§å®®ã‚¢ãƒ«ãƒ‡ã‚£ãƒ¼ã‚¸ãƒ£",
            "kofu": "ãƒ´ã‚¡ãƒ³ãƒ•ã‚©ãƒ¼ãƒ¬ç”²åºœ", "iwata": "ã‚¸ãƒ¥ãƒ“ãƒ­ç£ç”°", "yamaguchi": "ãƒ¬ãƒãƒ•ã‚¡å±±å£FC", "ehime": "æ„›åª›FC",
            "tosu": "ã‚µã‚¬ãƒ³é³¥æ –", "kumamoto": "ãƒ­ã‚¢ãƒƒã‚½ç†Šæœ¬", "sendai": "ãƒ™ã‚¬ãƒ«ã‚¿ä»™å°", "yamagata": "ãƒ¢ãƒ³ãƒ†ãƒ‡ã‚£ã‚ªå±±å½¢",
            "mito": "æ°´æˆ¸ãƒ›ãƒ¼ãƒªãƒ¼ãƒ›ãƒƒã‚¯", "chiba": "ã‚¸ã‚§ãƒ•ãƒ¦ãƒŠã‚¤ãƒ†ãƒƒãƒ‰åƒè‘‰", "toyama": "ã‚«ã‚¿ãƒ¼ãƒ¬å¯Œå±±", "fujieda": "è—¤æMYFC",
            "tokushima": "å¾³å³¶ãƒ´ã‚©ãƒ«ãƒ†ã‚£ã‚¹", "imabari": "FCä»Šæ²»", "nagasaki": "Vãƒ»ãƒ•ã‚¡ãƒ¼ãƒ¬ãƒ³é•·å´", "oita": "å¤§åˆ†ãƒˆãƒªãƒ‹ãƒ¼ã‚¿"
        },
        "j3": {
            "hachinohe": "ãƒ´ã‚¡ãƒ³ãƒ©ãƒ¼ãƒ¬å…«æˆ¸", "tochigi": "æ ƒæœ¨SC", "gunma": "ã‚¶ã‚¹ãƒ‘ç¾¤é¦¬", "matsumoto": "æ¾æœ¬å±±é›…FC",
            "kanazawa": "ãƒ„ã‚¨ãƒ¼ã‚²ãƒ³é‡‘æ²¢", "gifu": "FCå²é˜œ", "nara": "å¥ˆè‰¯ã‚¯ãƒ©ãƒ–", "sanuki": "ã‚«ãƒã‚¿ãƒãƒ¼ãƒ¬è®ƒå²",
            "kitakyushu": "ã‚®ãƒ©ãƒ´ã‚¡ãƒ³ãƒ„åŒ—ä¹å·", "kagoshima": "é¹¿å…å³¶ãƒ¦ãƒŠã‚¤ãƒ†ãƒƒãƒ‰FC", "fukushima": "ç¦å³¶ãƒ¦ãƒŠã‚¤ãƒ†ãƒƒãƒ‰FC",
            "tochigicity": "æ ƒæœ¨ã‚·ãƒ†ã‚£", "sagamihara": "SCç›¸æ¨¡åŸ", "nagano": "ACé•·é‡ãƒ‘ãƒ«ã‚»ã‚¤ãƒ­", "numazu": "ã‚¢ã‚¹ãƒ«ã‚¯ãƒ©ãƒ­æ²¼æ´¥",
            "fcosaka": "FCå¤§é˜ª", "tottori": "ã‚¬ã‚¤ãƒŠãƒ¼ãƒ¬é³¥å–", "kochi": "é«˜çŸ¥ãƒ¦ãƒŠã‚¤ãƒ†ãƒƒãƒ‰SC", "miyazaki": "ãƒ†ã‚²ãƒã‚¸ãƒ£ãƒ¼ãƒ­å®®å´",
            "ryukyu": "FCç‰çƒ"
        }
    }
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2) ã‚ªãƒ—ã‚·ãƒ§ãƒ³å–å¾—é–¢æ•°
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def get_jleague_options(season: str, category: str):
    """
    season, category ã‹ã‚‰ season_dictãƒ»club_dictãƒ»stat_type_dict ã‚’è¿”ã™
    """
    club_dict = {"all": "å…¨ã‚¯ãƒ©ãƒ–"}
    club_dict.update(club_dict_by_season_category.get(season, {}).get(category, {}))
    return season_dict, club_dict, stat_type_dict

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3) ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°é–¢æ•°
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def scrape_jleague_stats(
        season: str,
        stat_type: str,
        category: str = "j1",
        club: str = "all",
        sleep_sec: float = 1.0
    ) -> pd.DataFrame:
    """
    æŒ‡å®šã® å¹´ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ»æŒ‡æ¨™ï¼ˆå¿…é ˆï¼‰ã¨ã‚¯ãƒ©ãƒ–ï¼ˆä»»æ„ï¼‰ã§ DataFrame ã‚’è¿”ã™
    club="all" ã®å ´åˆã¯è©²å½“ã‚«ãƒ†ã‚´ãƒªã®å…¨ã‚¯ãƒ©ãƒ–ã‚’ãƒ«ãƒ¼ãƒ—
    """

    base_clubs = club_dict_by_season_category.get(season, {}).get(category, {})
    if not base_clubs:
        raise ValueError(f"â›” {season} ã® {category.upper()} ã¯è¾æ›¸æœªç™»éŒ²ã§ã™ã€‚")

    # ------------- å…¨ã‚¯ãƒ©ãƒ–ãƒ¢ãƒ¼ãƒ‰ -------------
    if club == "all":
        dfs = []
        for code, name in base_clubs.items():
            print(f"ğŸ“¥ {season}-{category.upper()} {stat_type} : {name}")
            try:
                dfs.append(
                    scrape_jleague_stats(season, stat_type, category, code, sleep_sec)
                )
            except Exception as e:
                print(f"âš ï¸ å¤±æ•—: {name} â†’ {e}")
            time.sleep(sleep_sec)
        return pd.concat(dfs, ignore_index=True)

    # ------------- å˜ä¸€ã‚¯ãƒ©ãƒ– -------------
    if club not in base_clubs:
        raise ValueError(f"â›” {club} ã¯ {season}-{category.upper()} ã«å­˜åœ¨ã—ã¾ã›ã‚“ã€‚")

    url = f"https://www.jleague.jp/stats/{category}/player/{season}/{club}/{stat_type}/"
    headers = {"User-Agent": "Mozilla/5.0"}
    res = requests.get(url, headers=headers, timeout=30)
    res.raise_for_status()
    soup = BeautifulSoup(res.text, "html.parser")

    data = []
    for li in soup.select("ul.ranking_list li"):
        rank = li.select_one("p[class^='number']")
        name = li.select_one("p.name")
        team = li.select_one("p.team")
        value = li.select_one("div[class^='ranking_stats'] p")

        # player_code
        a_tag = li.find("a", href=True)
        if a_tag and "/player/" in a_tag["href"]:
            player_code = a_tag["href"].strip("/").split("/")[-1]
        else:
            img = li.find("img", src=True)
            m = re.search(r"/player/(\d+)_s\.jpg", img["src"]) if img else None
            player_code = m.group(1) if m else None

        data.append({
            "season": season,
            "season_label": season_dict[season],
            "category": category,
            "club": club,
            "club_label": base_clubs[club],
            "stat_type": stat_type,
            "stat_label": stat_type_dict[stat_type],
            "rank": rank.text.strip() if rank else None,
            "name": name.text.strip() if name else None,
            "team": team.text.strip() if team else None,
            "value": value.text.strip() if value else None,
            "player_code": player_code
        })

    return pd.DataFrame(data)

import pandas as pd
from functools import reduce
import numpy as np
import re

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   n æŒ‡æ¨™å¯¾å¿œç‰ˆã‚³ãƒ³ãƒœãƒ©ãƒ³ã‚­ãƒ³ã‚°
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def combo_ranking(
        season: str,
        stat_codes: list[str],          # 1 å€‹ä»¥ä¸Šãªã‚‰è‡ªç”±
        category: str = "j1",
        club: str = "all",
        top: int | None = 20            # è¡¨ç¤ºãƒ»ä¿å­˜ã—ãŸã„ä¸Šä½ä»¶æ•° (None ãªã‚‰å…¨ä»¶)
    ) -> pd.DataFrame:
    """
    ä»»æ„æœ¬æ•°ã®ã‚¹ã‚¿ãƒƒãƒ„ã‚’æ›ã‘åˆã‚ã›ãŸãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¿”ã™
    ãƒ»score_prod = ã™ã¹ã¦ã®æŒ‡æ¨™ã®ç©
    æˆ»ã‚Šå€¤: df_sorted
    """
    if len(stat_codes) == 0:
        raise ValueError("stat_codes ã‚’ 1 ã¤ä»¥ä¸ŠæŒ‡å®šã—ã¦ãã ã•ã„ã€‚")

    # ------------- å„æŒ‡æ¨™ã‚’å–å¾—ã—ã¦ãƒãƒ¼ã‚¸ -------------
    dfs = []
    for code in stat_codes:
        tmp = scrape_jleague_stats(season, code, category, club)[
            ["player_code", "name", "team", "value"]
        ].copy()

        # æ•°å€¤åŒ–ï¼ˆ%, ã‚«ãƒ³ãƒé™¤å»ï¼‰
        tmp[code] = (
            tmp["value"]
            .str.replace("%", "", regex=False)
            .str.replace(",", "", regex=False)
            .astype(float)
        )
        tmp.drop(columns="value", inplace=True)
        dfs.append(tmp)

    df = reduce(
        lambda left, right: pd.merge(left, right,
                                     on=["player_code", "name", "team"],
                                     how="inner"),
        dfs
    )

    # ------------- ç©ã‚¹ã‚³ã‚¢è¨ˆç®— -------------
    df["score_prod"] = df[stat_codes].replace(np.nan, 0).prod(axis=1)

    # ------------- ã‚½ãƒ¼ãƒˆã—ã¦é †ä½ä»˜ã‘ -------------
    df_sorted = (
        df.sort_values("score_prod", ascending=False)
          .reset_index(drop=True)
    )
    df_sorted.index += 1  # ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç•ªå·

    # ------------- è¡¨ç¤ºï¼ä¿å­˜ -------------
    if top is not None:
        display(df_sorted.head(top))

    fname = f"{season}_{category.upper()}_{'_'.join(stat_codes)}_ranking.csv"
    df_sorted.to_csv(fname, index_label="rank", encoding="utf-8-sig")
    print(f"âœ… CSV saved: {fname}")

    return df_sorted

# å¥½ããªã ã‘æŒ‡æ¨™ã‚’ä¸¦ã¹ã¦ OK
my_stats = ["shoot_per_game", "shoot_rate", "air_battle_win_rate"]

df_rank = combo_ranking(
    season="2025",
    stat_codes=my_stats,
    category="j1",
    club="all",
    top=30           # ä¸Šä½ 30 äººã‚’è¡¨ç¤º
)

df_rank

# æ—¢ã« df_rank ã¨ fname ãŒä½œã‚‰ã‚Œã¦ã„ã‚‹å‰æ
df_rank.to_csv(fname, index=False, encoding='utf-8-sig')  # å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«åã®ã¾ã¾ä¿å­˜

# Colab ç’°å¢ƒãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆPCï¼‰ã¸å³ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
from google.colab import files
files.download(fname)

